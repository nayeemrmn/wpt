<!doctype html>
<html>
  <head>
    <meta charset=utf-8>
    <title>Test cookie domain attribute parsing</title>
    <meta name=help href="https://tools.ietf.org/html/rfc6265#section-5.2.3">
    <meta name="timeout" content="long">
    <script src="/resources/testharness.js"></script>
    <script src="/cookies/resources/cookie-test.js"></script>
  </head>
  <body>
    <script>
      const path        = "path=/cookies/attributes"
      const port        = "{{ports[http][0]}}";
      const host        = "{{host}}";              // example.org
      const wwwHost     = "{{domains[www]}}";      // home.example.org
      const www1Host    = "{{domains[www1]}}";     // sibling.example.org
      const www2wwwHost = "{{domains[www2.www]}}"; // subdomain.home.example.org

      const domainTests = [
        {
          cookie: `test=1; domain=${wwwHost}`,
          expected: "test=1",
          name: "Return cookie for domain match (domain attribute is suffix of the host name)",
        },
        {
          cookie: `test=2; domain=${wwwHost}`,
          expected: "test=2",
          name: "Return cookie for domain match (domain attribute is suffix of the host name, with leading '.')",
        },
        {
          cookie: `test=3; domain=${www2wwwHost}`,
          expected: "test=3",
          name: "Return cookie for domain match",
        },
        {
          cookie: "test=4",
          expected: "test=4",
          name: "Return cookie set without domain attribute",
        },
        {
          cookie: `test=5; domain=${www1Host}; domain=`,
          expected: "",
          name: "No cookie returned for domain mismatch (first attribute is a different subdomain and second is bare)",
        },
      ];

      for (const test of domainTests) {
        // All the tests in this file depend on being redirected to this location
        // for domain matching (or, crucially, not matching).
        const redirectedLocation = `http://${www2wwwHost}:${port}/cookies/attributes/resources/path.html`;
        if (!Array.isArray(test.cookie)) {
          test.cookie += `; ${path}`;
        }
        httpRedirectCookieTest(test.cookie, test.expected, test.name,
                               redirectedLocation);
      }
    </script>
  </body>
</html>
