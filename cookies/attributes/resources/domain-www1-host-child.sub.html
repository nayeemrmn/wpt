<!doctype html>
<html>
  <head>
    <meta charset=utf-8>
    <title>Test cookie domain attribute parsing</title>
    <meta name=help href="https://tools.ietf.org/html/rfc6265#section-5.2.3">
    <meta name="timeout" content="long">
    <script src="/resources/testharness.js"></script>
    <script src="/cookies/resources/cookie-test.js"></script>
  </head>
  <body>
    <script>
      const path        = "path=/cookies/attributes"
      const port        = "{{ports[http][0]}}";
      const host        = "{{host}}";              // example.org
      const wwwHost     = "{{domains[www]}}";      // home.example.org
      const www1Host    = "{{domains[www1]}}";     // sibling.example.org
      const www2wwwHost = "{{domains[www2.www]}}"; // subdomain.home.example.org

      const domainTests = [
        {
          cookie: `test=1; domain=${wwwHost}`,
          expected: "",
          name: "No cookie returned for domain mismatch (subdomains differ)",
        },
        {
          cookie: `test=2; domain=.${wwwHost}`,
          expected: "",
          name: "No cookie returned for domain mismatch (subdomains differ, with leading '.')",
        },
        {
          cookie: `test=3; domain=${www1Host}`,
          expected: "test=3",
          name: "Return cookie for domain match",
        },
        {
          cookie: `test=4; domain=.${host}; domain=${wwwHost}`,
          expected: "",
          name: "No cookie returned when domain attribute does not domain-match (and first does)",
        },
        {
          cookie: `test=5; domain=${wwwHost}; domain=.${host}`,
          expected: "test=5",
          name: "Return cookie for domain attribute match (first does not, but second does)",
        },
        {
          cookie: `test=6; domain=.${www1Host}`,
          expected: "test=6",
          name: "Return cookie for domain match (with leading '.')",
        },

      ];

      for (const test of domainTests) {
        // All the tests in this file depend on being redirected to this location
        // for domain matching (or, crucially, not matching).
        const redirectedLocation = `http://${www1Host}:${port}/cookies/attributes/resources/path.html`;
        if (!Array.isArray(test.cookie)) {
          test.cookie += `; ${path}`;
        }
        httpRedirectCookieTest(test.cookie, test.expected, test.name,
                               redirectedLocation);
      }
    </script>
  </body>
</html>
